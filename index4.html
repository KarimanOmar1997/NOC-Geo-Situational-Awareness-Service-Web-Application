<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />

    <title>
      ArcGIS Developer Guide: Predominance educational attainment
    </title>

    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.28/esri/themes/light/main.css"
    />
    <script src="https://js.arcgis.com/4.28/"></script>

    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
    </style>

    <!--ARCADE SCRIPTS-->

    <!--PREDOMINANT POLITICAL PARTY-->

    <script type="text/plain" id="predominance">

      // store field values in variables with
      // meaningful names. Each is the total count
      // of people that attained each education level

      var noHighSchool = $feature.NOHS_CY;
      var someHighSchool = $feature.SOMEHS_CY;
      var highSchool = $feature.HSGRAD_CY;
      var ged = $feature.GED_CY;
      var someCollege = $feature.SMCOLL_CY;
      var associates = $feature.ASSCDEG_CY;
      var bachelors = $feature.BACHDEG_CY;
      var grad = $feature.GRADDEG_CY;

      var all = [
        noHighSchool, someHighSchool, highSchool,
        ged, someCollege, associates,
        bachelors, grad,
      ];

      // Match the maximum value with the label
      // of the respective field and return it for
      // use in a UniqueValueRenderer

      return Decode( Max(all),
        noHighSchool, 'No high school',
        someHighSchool, 'Some high school',
        highSchool, 'High school diploma',
        ged, 'GED',
        someCollege, 'Some college',
        associates, 'Associate\'s degree',
        bachelors, 'Bachelor\'s degree',
        grad, 'Master\'s degree or higher',
      'n/a' );

    </script>

    <script>
      require([
        "esri/config",
        "esri/WebMap",
        "esri/views/MapView",
        "esri/layers/FeatureLayer",
        "esri/widgets/Legend",
        "esri/widgets/Expand"
      ], function (esriConfig,WebMap, MapView, FeatureLayer, Legend, Expand) {

        esriConfig.apiKey = "AAPK8439fc9a325c4593a3234a4fbafe73caXK2STpUubI24-8zi9egsX2fCBrOdoOUY5qDXEAIHWamfxipss0ffj3zCLo7amIE6";

        function createSymbol(color) {
          return {
            type: "simple-fill",
            color: color,
            outline: {
              width: 0.3,
              color: [255, 255, 255, 0.2]
            }
          };
        }


        const colors = [ "#00b6f1", "#d9bf0d", "#6a28c7", "#c44245", "#b9a087", "#ab579d", "#78aea0", "#1e8553" ];
        const predominanceArcade = document.getElementById("predominance").text;
        const renderer = {
          type: "unique-value",
          valueExpression: predominanceArcade,
          valueExpressionTitle: "Predominant educational attainment",
          uniqueValueInfos: [
            {
              value: "Master's degree or higher",
              symbol: createSymbol(colors[0])
            }, {
              value: "Bachelor's degree",
              symbol: createSymbol(colors[1])
            }, {
              value: "Associate's degree",
              symbol: createSymbol(colors[2])
            }, {
              value: "Some college",
              symbol: createSymbol(colors[3])
            }, {
              value: "GED",
              symbol: createSymbol(colors[4])
            }, {
              value: "High school diploma",
              symbol: createSymbol(colors[5])
            }, {
              value: "Some high school",
              symbol: createSymbol(colors[6])
            }, {
              value: "No high school",
              symbol: createSymbol(colors[7])
            }
          ]
        };


        const layer = new FeatureLayer({
          portalItem: {
            id: "1cbb0faa0f1f424bbe213bfae9319309"
          },
          renderer: renderer,
          blendMode: "multiply"
        });

        const map = new WebMap({
          portalItem: {
            id: "9cf503b654144873a8e33f996f91ba1d"
          },
          layers: [ layer ]
        });

        const view = new MapView({
          container: "viewDiv",
          map: map,
          scale: 577790,
          center: [ -117.8099, 34.0441 ],
          constraints: {
            snapToZoom:false
          }
        });

        view.ui.add(new Expand({
          content: new Legend({
            view: view
          }),
          view: view,
          expanded: false
        }), "top-right");

      });
    </script>
  </head>

  <body>
    <div id="viewDiv"></div>
  </body>
</html>